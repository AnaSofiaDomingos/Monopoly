<!DOCTYPE html>
<html>
<head>
	<meta charset=utf-8>
	<link rel="stylesheet" type="text/css" href="./css/style.css">
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="./socket.io-1.3.4.js"></script>
	<link rel="stylesheet" type="text/css" href="./css/pion.css">
	<title>Monopoly</title>
	<script>

		var GameID = 1;
		var idPlayer;
		var sentJson;
		var localJson = [{
			"owns" : [{'country' : 35,'level' : 1},{'country' : 24,'level' : 2}],
			"cards" : [{}],
			"loans" : [{}]
		}];
		// console.log(localJson[0].owns);

		var idGlobal = Math.floor(Math.random() * 4) + 1;
		// console.log(idGlobal);
		var payspossede = [
			{
				'idPays' : 24,
				'etatAmelioration' : 2
			},
			{
				'idPays' : 35,
				'etatAmelioration' : 1
			}
		];
		var data = {
			'RoomID'  : GameID,
			'idGlobal' : idGlobal
		};

		// fonction permettant de construire les cases de chaque pays et carte
		function constructionCase(typecase, id, sens, parent ){
			if (sens == 1)
				for (var i = id; i < (id+8); i++)
						$('#'+parent).append("<div id='case" + i + "' class='"+ typecase + "'></div>");

			else
				for (var i = id; i > (id-8); i--)
					$('#'+parent).append("<div id='case" + i + "' class='"+ typecase + "'></div>");
		}

		var socket = io('http://localhost:8080/subscribe');

		socket.emit('handshake', data); // tell the server which game this user is part of

		socket.on("test",function(data){
// 			console.log(data);
		});

		socket.on('notify',function(data){
			receiveData(data);
		});

		socket.on('robbed', sample) {		
			desherit(sample);
		}
		
		socket.on('PlayerNumber',function(idLocal,dataInitGame){
			idPlayer = idLocal;
// 			console.log(idPlayer);
			dataInitGame.upgraded = [{
				"country": 35, // Suisse
				"level": "2"
			}];
// 			console.log(dataInitGame);

			sentJson = {
				"id": idPlayer,

				"bought": dataInitGame.bought,

				"upgraded": dataInitGame.upgraded,

				"sold" : dataInitGame.sold,
				"used" : dataInitGame.used,

				"loaned": dataInitGame.loaned,

				"drew": dataInitGame.drew,
				"recovered" : dataInitGame.recovered,
				"account": dataInitGame.account,
				"state" : dataInitGame.state,
				"position": joueurs[idPlayer],
				"GameID" : GameID

			};
// 			console.log(sentJson.upgraded);
			updateUpgrades(sentJson.upgraded);
			init(idPlayer);
		});

	</script>
	<script src="communication.js" type="text/javascript"></script>
	<script src="move.js" type="text/javascript"></script>
</head>
<body>
	<div id="plateau">
		<div id="amérique">
			<div id="case18" class="case-coin"></div>
			<script> constructionCase("case-horizontal",19, 1,'amérique'); </script>
			<div id="case27" class="case-coin"></div>
		</div>

		<div id="asie">
			<script> constructionCase("case-vertical", 17, 0,'asie'); </script>
		</div>

		<div id="case-centrale"></div>

		<div id="europe">
			<script> constructionCase("case-vertical", 28, 1,'europe'); </script>
		</div>

		<div id="afrique">
			<div id="case9" class="case-coin"></div>
			<script> constructionCase("case-horizontal", 8, 0 ,'afrique'); </script>
			<div id="case0" class="case-coin"></div>
		</div>

	</div>

	<br/>
	<input id="btnDes" type="button" value="Lancer les dés" onclick="lancerDes(idPlayer)" />
	<input id="btnFinTour" type="button" value="Fin du tour" onclick="finTour(GameID,idPlayer)" />
	<input id="btnUpgrade" type="button" value="Améliorer" onclick="upgrade(idPlayer)" />
	<input id="btnBuy" type="button" value="Acheter" onclick="buy()" />
	<br/>
	<script type="text/javascript">

	</script>
</body>
</html>