<!DOCTYPE html>
<html>
<head>
	<meta charset=utf-8>
	<link rel="stylesheet" type="text/css" href="./css/style.css">
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="./socket.io-1.3.4.js"></script>
	<link rel="stylesheet" type="text/css" href="./css/pion.css">
	<title>Monopoly</title>
	<script>

		var GameID = 1;
		var idGlobal = Math.floor(Math.random() * 4) + 1;
		var idPlayer;
		var sentJson;

		var owns = [
			{
				'country' : 24,
				'level' : 2
			},
			{
				'country' : 22,
				'level' : 1
			}
		];
		var cards = [{'card' : ""}]
		var loans = [{'country' : ""}]
		var localJson = [{
				"owns" : owns,
				"cards" : cards,
				"loans" : loans
		}];

		// console.log(idGlobal);
		var data = {
			'RoomID'  : GameID,
			'idGlobal' : idGlobal
		};


		var nbCase = 36;


		var countries;
		// fonction permettant de construire les cases de chaque pays et carte
		function constructionCase(typecase, id, sens, parent ){
			if (sens == 1)
				for (var i = id; i < (id+8); i++)
					$('#'+parent).append("<div id='case" + i + "' class='"+ typecase + "'></div>");
			else
				for (var i = id; i > (id-8); i--)
					$('#'+parent).append("<div id='case" + i + "' class='"+ typecase + "'></div>");
		}


		// place le pays dans les div
		function placeCountriesCartes(){
			for (var i=0; i<nbCase;i++){
				var country = findCountry(i);
				if (country != undefined)
					$('#case'+ i).append("<span class='case'>"+ country.NomPays +"</span>");
			}

			// taxes
			$('#case3').append("<span class='case'>Taxes</span>");
			$('#case12').append("<span class='case'>Taxes</span>");
			$('#case21').append("<span class='case'>Taxes</span>");
			$('#case30').append("<span class='case'>Taxes</span>");

			// cartes 
			$('#case6').append("<span class='case'>Carte</span>");
			$('#case15').append("<span class='case'>Carte</span>");
			$('#case24').append("<span class='case'>Carte</span>");
			$('#case33').append("<span class='case'>Carte</span>");

			// coins
			$('#case0').append("<span class='case'>Depart</span>");

			$('#case9').append("<span class='case'>Prison</span>");
			$('#case18').append("<span class='case'>Parking</span>");
			$('#case27').append("<span class='case'>Aller Prison</span>");
		}

		// trouve le pays correspondant à la case avec la position
		function findCountry(id){
			for (var i=0; i< countries.length;i++){
				if (countries[i].Position == id)
					return countries[i];

			}
		}

		// retrouve un object en fonctino de l'id
		function getById(id, table){
			if (table == 'pays'){
				for (var i=0; i< countries.length; i++){
					if (countries[i].idPays == id)
						return countries[i].NomPays;
				}
			}
			/*else if (table == 'carte') {
				for (var i=0; i< carte.length; i++){
					
				}
			}*/

		}
		

		// recupere les information en fonction d'un id
		function getInfos(id){
			for (var i=0; i < localJson[id].owns.length; i++)
				$('#pays').after("<div class='possede'>" + getById(localJson[id].owns[i].country, 'pays') + "</div>");
			

			for (var i=0; i < localJson[id].cards.length; i++)
				$('#cartes').after("<div class='possede'>" + localJson[id].cards[i].card + "</div>");

			$('#credit').after("<p>"+ sentJson.account +"</p>"); 

		}

		var socket = io('http://localhost:8080/subscribe');

		socket.emit('handshake', data); // tell the server which game this user is part of

		socket.on('notify',function(data){
			receiveData(data);
		});

		socket.on('PlayerNumber',function(idLocal,dataInitGame){
			idPlayer = idLocal;
			dataInitGame.upgraded = [{
				"country": 25, // Suisse
				"level": "2"
			}];

			countries = dataInitGame.pays;
 			

			sentJson = {
				"id": idPlayer,

				"bought": dataInitGame.bought,

				"upgraded": dataInitGame.upgraded,

				"sold" : dataInitGame.sold,
				"used" : dataInitGame.used,

				"loaned": dataInitGame.loaned,

				"drew": dataInitGame.drew,
				"recovered" : dataInitGame.recovered,
				"account": dataInitGame.account,
				"state" : dataInitGame.state,
				"position": joueurs[idPlayer],
				"GameID" : GameID

			};

			updateUpgrades(sentJson.upgraded);
			init(idPlayer);
			placeCountriesCartes();
			getInfos(idPlayer);
		});

	</script>
	<script src="move.js" type="text/javascript"></script>
	<script src="communication.js" type="text/javascript"></script>
	<script src="bank.js" type="text/javascript"></script>
</head>
<body>
	<div id="plateau">
		<div id="amérique">
			<div id="case18" class="case-coin"></div>
			<script> constructionCase("case-horizontal",19, 1,'amérique'); </script>
			<div id="case27" class="case-coin"></div>
		</div>

		<div id="asie">
			<script> constructionCase("case-vertical", 17, 0,'asie'); </script>
		</div>

		<div id="case-centrale"></div>

		<div id="europe">
			<script> constructionCase("case-vertical", 28, 1,'europe'); </script>
		</div>

		<div id="afrique">
			<div id="case9" class="case-coin"></div>
			<script> constructionCase("case-horizontal", 8, 0 ,'afrique'); </script>
			<div id="case0" class="case-coin"></div>
		</div>

	</div>
	<div id='infosPays'>
		informations pays
	</div>

	<div class="infoAccount">
		<label id="pays">PAYS</label>

		<br/>
		<label id="cartes">CARTES</label>

		<br/>
		<label id="credit">CREDIT</label>

		<br/>
	</div>
	<br/>

	<div class="actions">
		<input id="btnDes" type="button" value="Lancer les dés" onclick="lancerDes(idPlayer)" />
		<input id="btnFinTour" type="button" value="Fin du tour" onclick="finTour(GameID,idPlayer)" />
		<input id="btnUpgrade" type="button" value="améliorer" onclick="upgrade(idPlayer)" />
		<input id="btnBuy" type="button" value="Acheter" onclick="buy()" />
	
		<br/>
	</div>

</body>
</html>
